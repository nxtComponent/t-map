<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../google-map/google-map.html">
<link rel="import" href="../google-map/google-map-marker.html">
<link rel="import" href="../google-map/google-map-directions.html">
<link rel="import" href="google-map-nearby-search.html">
<link rel="import" href="../paper-styles/paper-styles.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-icons/maps-icons.html">
<link rel="import" href="../iron-media-query/iron-media-query.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-card/paper-card.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-menu-button/paper-menu-button.html">
<link rel="import" href="../paper-checkbox/paper-checkbox.html">

<dom-module id="t-hotel-map">
	<template>
		<style include="iron-flex">
		.indigo{
			background: #1976d3;
			color: #fff;
		}
		:host {
			font-family: 'Roboto', sans-serif;
			position: fixed;
			height:calc(100vh - 120px);
			display: block;
			width:calc(100vw - 	40px);
			max-width: 1200px;
			padding: 60px 20px ;
			left: 50%;
			background: black;
			transform: translateX(-50%);
		}
		paper-menu-button{
			padding:0
		}
		.toolbar paper-button{
			background: #eaeaea;
		}
		.container{
			height: 100%;
			padding: 0 20px;
		}
		.map-container{
			position: relative;
		}
		.place-list ul{
			-webkit-padding-start: 20px;
		}
		.place-list li{
			font-size:14px;
			line-height: 30px;
		}
		.place-list{
			padding: 0 20px;
			font-size: 14px;
			color: #929292;
			width: 260px;
			background: #eaeaea;
			height:100%;
			overflow-x: hidden;
			overflow-y: auto;
		}
		google-map {
			display: block;
			height: 100%;
		}
		paper-card {
			z-index: 1;
		}
		.place-list h3{
			font-weight: 500;
		}
		.map-view{
			position: relative;
		}
		.toolbar{
			position: absolute;
			top: 10px;
			z-index: 1;
			left: 10px;
		}
		.header{
			padding: 22px 24px;
			height: 70px;
			background: #fff;
		}
		h1{
			font-weight: 400;
			margin: 0;
		}
		google-map-directions{
			display: block;
		}
		@media (min-width : 320px) and (max-width : 767px){

			iron-icon{
			 --iron-icon-height: 12px;
			 --iron-icon-width: 12px;
		 }
			.toolbar paper-button{
				font-size: 9px;
				margin: 0;
				font-weight: 700;
			}
			:host{
				height: 100vh;
				width: 100vw;
				padding: 5px;
			}
			.container{
				padding:0;
			}
		}
		@media (max-width: 1024px) and (min-width: 768px){
			.place-list{
				width: 200px;
			}
		}
		</style>

		<iron-media-query query="(min-width : 320px) and (max-width : 767px)" query-matches="{{_isMobile}}"></iron-media-query>
		<iron-media-query query="(max-width: 1024px) and (min-width: 768px)" query-matches="{{_isTablet}}"></iron-media-query>

		<div class="container layout vertical">

			<div class="header layout horizontal">
				<div class="flex">
					<h1> jsdf df dfd </h1>
					<p> jsdf df dfd </p>
				</div>
				<div><paper-button raised class="indigo"> Reserve Now</paper-button></div>
			</div>
			<div class="map-container layout horizontal flex">
				<template is="dom-if" if="[[currentFilters.length]]">
					<div class="place-list" hidden$="[[_isMobile]]">
						<h3>Point of Interest</h3>
						<ul>
							<template is="dom-repeat" items="{{currentFilters}}" >
								<template is="dom-repeat" items="{{_getPlaces(item)}}" as="marker">
									<li>[[marker.name]]</li>
								</template>
							</template>
						</ul>
					</div>
				</template>
				<div class="flex map-view">
					<div class="toolbar">
						<paper-menu-button>
							<paper-button  slot="dropdown-trigger"  raised><iron-icon ></iron-icon>What's Nearby</paper-button>
							<paper-listbox slot="dropdown-content">
								<template is="dom-repeat" items="[[_placeTypes]]">
									<paper-item role="menuitemcheckbox">
										<paper-checkbox on-change="_placeListChanged">[[item.label]]</paper-checkbox>
									</paper-item>
								</template>
							</paper-listbox>
						</paper-menu-button>
						<paper-button  on-tap="_setCenter" raised><iron-icon icon="home"></iron-icon>Hotel</paper-button>
						<paper-menu-button>
							<paper-button on-tap="_setupPlacesAutocomplete"  slot="dropdown-trigger" raised><iron-icon icon="maps:directions"></iron-icon>Directions</paper-button>
							<paper-listbox slot="dropdown-content">
								<paper-card elevation="2">
									<paper-item>
								    <!-- <input id="start" class="controls" type="text" placeholder="Street, City, State, Zip"> -->
										<paper-input id="start" label="Start address" >
											<iron-icon icon="search" slot="prefix"></iron-icon>
										</paper-input>
									</paper-item>
									<paper-item>
								    <!-- <input id="end" class="controls" type="text" placeholder="Street, City, State, Zip"> -->
										<paper-input id="end" label="End address" >
											<iron-icon icon="search" slot="prefix"></iron-icon>
										</paper-input>
									</paper-item>
								</paper-card>

							</paper-listbox>
						</paper-menu-button>
					</div>
					<google-map-nearby-search on-google-map-nearby-search-results="_onPlaceFilter" map="[[map]]"  radius="5000" results="{{_results}}" types="[[_placesToFilter]]"> </google-map-nearby-search>
					<google-map id="map" map="{{map}}" latitude="[[latLng.latitude]]" longitude="[[latLng.longitude]]"
					api-key="[[apiKey]]" disable-default-ui zoom="13">
					<template is="dom-repeat" items="{{currentFilters}}" >
						<template is="dom-repeat" items="{{_getPlaces(item)}}" as="marker">
							<google-map-marker animation="drop" latitude="{{marker.latitude}}" icon="[[marker.icon]]" longitude="{{marker.longitude}}">
								<h2>{{marker.name}}</h2>
								<span>{{marker.formatted_address}}</span>
							</google-map-marker>
						</template>
					</template>
					<google-map-marker animation="drop" latitude="[[latLng.latitude]]" longitude="[[latLng.longitude]]">
								<h4>[[locationName]]</h4>
								<span>[[locationDetails]]</span>
					</google-map-marker>
				</google-map>
				<google-map-directions api-key="[[apiKey]]" map="[[map]]" start-address="[[_origin]]" end-address="[[_destination]]" ></google-map-directions>
			</div>



		</div>
	</div>

</template>

<script>

class THotelMap extends Polymer.Element {

	static get is() { return 't-hotel-map'; }

	static get properties() {
		return {
			apiKey: {
				type: String,
				value: 'AIzaSyCT5zC7NQ1lzgAzPPu5W0jycrHkI-rYuB8'
			},
			start:{
				type: String,
				value: 'The Star'
			},
			_mapCenter: Object,
			end: {
				type: String,
				value:''
			},
			_results: {
				type: Array,
				value: []
			},
			locationName: {
				type: String,
				value: 'The Star'
			},
			locationDetails: {
				type: String,
				value: ''
			},
			latLng: {
				type: Object,
				value: function(){
					return {
						latitude:-33.8665433,
						longitude:151.1956316
					}
				}
			},
			_placesToFilter:{
				type: Array,
				value: []
			},
			placesToShow:{
				type: Object,
				value: {}
			},
			currentFilters: {
				type: Array,
				value: []
			},
			_placeTypes: {
				type: Array,
				value: function(){
					return [
						{ label : "Airport", icon: "maps:local-airport", list: ["airport"]},
						{ label : "Bank", icon: "maps:local-atm", list: ["atm", "bank"]},
						{ label : "Entertainment", icon: "maps:local-movies", list: ["amusement_park", "aquarium", "art_gallery", "bowling_alley", "casino", "movie_theater", "zoo"]},
						{ label : "Food", icon: "maps:restaurant", list: ["cafe", "food", "restaurant"]},
						{ label : "Health & Wellness", icon: "maps:local-pharmacy", list: ["beauty_salon", "gym", "health", "pharmacy", "spa"]},
						{ label : "Nightlife", icon: "maps:local-bar", list: ["bar", "casino", "night_club"]},
						{ label : "Shopping", icon: "maps:local-mall", list: ["city_hall", "clothing_store", "convenience_store", "department_store", "electronics_store", "jewelry_store", "shoe_store", "shopping_mall", "bicycle_store"]},
						{ label : "Transport", icon: "maps:subway", list: ["bus_station", "car_dealer", "car_rental", "train_station", "taxi_stand", "travel_agency"]}
					]
				}
			}
		};
	}

	ready(){
		super.ready();
	}

	_placeListChanged(e){
		let isChecked = e.target.checked;
		let placeTypes = e.model.item.list;
		this._latestFilter = e.model.item.label;
		if(isChecked){
			this._placesToFilter = placeTypes;
		}
		else{
			this.set('placesToShow.' + this._latestFilter , []);
			this.push('currentFilters', this._latestFilter);
			var latestFilter = this._latestFilter;
			var index = this.currentFilters.findIndex( function(item) {
				return item === latestFilter;
			} );
			this.splice('currentFilters', index, 1);
			this.notifyPath('currentFilters');
		}
	}

	_onPlaceFilter(e, detail){
		this.set('placesToShow.' + this._latestFilter , this._results);
		this.push('currentFilters', this._latestFilter);
		this.notifyPath('currentFilters');
	}

	_hasFilters(currentFilters){
		return currentFilters.length > 0;
	}

	_getPlaces(name){
		return this.placesToShow[name]
	}

	_getMarker(type){
		const placeType = this._placeTypes.filter(p => p.label === type)[0];
		return placeType.icon;
	}

	_setCenter(){
		this.map.setCenter(new google.maps.LatLng(this.latLng.latitude, this.latLng.longitude));
		this.$.map.resize();
	}

	_endPlaceChanged(e){
		console.log(e);
	}

	_startPlaceChanged(e){
		console.log(e);
	}

	_setupPlacesAutocomplete(){
		let startAutocomplete = new google.maps.places.Autocomplete(this.$.start);
		var hotelMap = this;
		startAutocomplete.addListener('place_changed', function(){
			hotelMap.$.start.value = this.getPlace().formatted_address;
			hotelMap._origin = this.getPlace().geometry.location;
		});
	 startAutocomplete.bindTo('bounds', this.map);
		let endAutocomplete = new google.maps.places.Autocomplete(this.$.end);
		endAutocomplete.addListener('place_changed', function(){
			hotelMap.$.end.value = this.getPlace().formatted_address;
			hotelMap._destination = this.getPlace().geometry.location;
		});
		 endAutocomplete.bindTo('bounds', this.map);
	}
}

window.customElements.define(THotelMap.is, THotelMap);
</script>
</dom-module>
